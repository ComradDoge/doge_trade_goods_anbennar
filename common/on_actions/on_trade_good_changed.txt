#When adding effects directly in on_actions always consider if it would be best to do so through a scripted effect. on_actions with a lot of script in them are harder to get an overview of.

# ROOT = province, FROM = country
# Used by Trade Goods Expanded
on_trade_good_changed = {
	on_trade_good_changed_estate_privileges_effect = yes
	on_trade_good_changed_government_effect = yes
	if = {
		limit = {
			OR = {
				has_province_modifier = wine_bonus_prod
				has_province_modifier = grain_bonus_prod
				has_province_modifier = artifice_ageifier_bonus
				has_province_modifier = artifice_growthbeans_bonus
				has_province_modifier = artifice_pearl_cultivator_bonus
				has_province_modifier = wine_lord_wine
				has_province_modifier = eordan_expedition_site
				has_province_modifier = damestear_rich_deposit
				has_province_modifier = huge_damestear
				has_province_modifier = big_fungi
				has_province_modifier = dwindling_resources
				has_province_modifier = orlghelovar_glasslord_glass
				has_province_modifier = orlghelovar_reformed_glassworkers
				has_province_modifier = orlghelovar_glass_value
			}
		}
		remove_province_modifier = wine_bonus_prod
		remove_province_modifier = grain_bonus_prod
		remove_province_modifier = artifice_ageifier_bonus
		remove_province_modifier = artifice_growthbeans_bonus
		remove_province_modifier = artifice_pearl_cultivator_bonus
		remove_province_modifier = wine_lord_wine
		remove_province_modifier = eordan_expedition_site
		remove_province_modifier = damestear_rich_deposit
		remove_province_modifier = huge_damestear
		remove_province_modifier = big_fungi
		remove_province_modifier = dwindling_resources
		remove_province_modifier = orlghelovar_glasslord_glass
		remove_province_modifier = orlghelovar_reformed_glassworkers
		remove_province_modifier = orlghelovar_glass_value
	}
	if = {
		limit = { 
			has_advanced_hold_infrastructure = yes
			NOT = {
				province_id = 2914 #verkal gulan
				province_id = 4236 #mithradhum
			}
		}
		clr_hold_advanced_infrastructure = yes
	}
	hidden_effect = {
		if = {
			limit = {
				trade_goods = wine
				FROM = { has_reform = monastic_breweries_reform }
			}
			remove_province_modifier = grain_bonus_prod
			add_province_modifier = {
				name = wine_bonus_prod
				duration = -1
				hidden = yes
			}
		}
		if = {
			limit = {
				trade_goods = wine
				OR = {
					FROM = { has_reform = wine_lord_reform }
					FROM = { has_reform = roilsard_elective }
					FROM = { has_reform = wineport_merchants }
				}
			}
			add_province_modifier = {
				name = wine_lord_wine
				duration = -1
				hidden = yes
			}
		}
		if = {
			limit = {
				trade_goods = wine
				owner = {
					has_estate_privilege = artifice_invention_wine_ageifier
				}
			}
			add_province_modifier = {
				name = artifice_ageifier_bonus
				duration = -1
				hidden = yes
			}
		}
		if = {
			limit = {
				owner = {
					has_estate_privilege = artifice_invention_growth_beans
				}
				OR = {
					trade_goods = grain
					trade_goods = cocoa
					trade_goods = sugar
					trade_goods = wine
					trade_goods = tobacco
					trade_goods = spices
					trade_goods = incense
					trade_goods = tea
					trade_goods = coffee
					trade_goods = fungi
					trade_goods = serpentbloom
				}
			}
			add_province_modifier = {
				name = artifice_growthbeans_bonus
				duration = -1
				hidden = yes
			}
		}
		if = {
			limit = {
				trade_goods = gems
				owner = {
					has_estate_privilege = artifice_invention_pearl_cultivators
				}
			}
			add_province_modifier = {
				name = artifice_pearl_cultivator_bonus
				duration = -1
				hidden = yes
			}
		}
		if = {
			limit = {
				trade_goods = grain
				OR = {
					FROM = { has_reform = monastic_breweries_reform }
					FROM = { has_reform = wine_lord_reform }
				}
			}
			remove_province_modifier = wine_bonus_prod
			add_province_modifier = {
				name = grain_bonus_prod
				duration = -1
				hidden = yes
			}
		}
		
		#honderaak incident gnoll minorities for colonies
		if = {
			limit = {
				is_city = no
				owner = { is_part_of_hre = yes has_country_modifier = honderaak_incident_colonization NOT = { culture_group = gnollish } }
			}
			random = {
				chance = 50
				province_event = { id = flavor_honderaak.6 days = 30 random = 60 }
			}
		}
		#Orlghelovar
		if = {
			limit = {
				trade_goods = glass
				owner = { tag = I12 }
			}
			if = {
				limit = {
					owner = {
						OR = {
							has_reform = orlghelovar_glasslords
							has_reform = orlghelovar_science
						}
					}
					NOT = { has_province_modifier = orlghelovar_glasslord_glass }
				}
				add_province_modifier = { name = orlghelovar_glasslord_glass duration = -1 hidden = yes }
			}
			if = {
				limit = {
					owner = { has_reform = orlghelovar_glass_worker_reform }
					NOT = { has_province_modifier = orlghelovar_reformed_glassworkers }
				}
				add_province_modifier = { name = orlghelovar_reformed_glassworkers duration = -1 hidden = yes }
			}
			if = {
				limit = {
					owner = { has_country_modifier = orlghelovar_sapphire_glass }
					NOT = { has_province_modifier = orlghelovar_glass_value }
				}
				add_province_modifier = { name = orlghelovar_glass_value duration = -1 hidden = yes }
			}
		}
		#newshire
		if = {
			limit = {
				OR = {
					trade_goods = grain
					trade_goods = livestock
				}
				FROM = { 
					OR = {
						has_reform = newshire_stewardship
						has_reform = newshire_high_stewardship
					}
				}
			}
			add_province_modifier = {
				name = newshire_stewardship_boost
				duration = -1
				hidden = yes
			}
		}
		else_if = {
			limit = {
				NOT = { 
					FROM = { 
						OR = {
							has_reform = newshire_stewardship
							has_reform = newshire_high_stewardship
						}
					} 
				}
				has_province_modifier = newshire_stewardship_boost
			}
			remove_province_modifier = newshire_stewardship_boost
		}
    }



	# TRADE GOODS EXPANDED
	owner = {
		country_event = { 
			id = New_TradeGood_Events.2
		}
	}
	#if = {
	#	limit = {
	#		ROOT = { trade_goods = silver }
	#		NOT = { has_province_modifier = silver_debuff }
	#	}
	#	ROOT = {
	#		add_province_modifier = { 
	#			name = silver_debuff
	#			duration = -1
	#			hidden = yes	
	#		}
	#	}
	#}
	#if = {
	#	limit = { 
	#		ROOT = { 
	#			AND = {
	#				NOT = { trade_goods = silver }
	#				has_province_modifier = silver_debuff
	#			}
	#		}
	#	}
	#	remove_province_modifier = silver_debuff
	#}
	#
	#if = {
	#	limit = {
	#		ROOT = { 
	#			trade_goods = indigo 
	#			continent = europe
	#		}
	#		NOT = { has_province_modifier = woad_type }
	#	}
	#	ROOT = {
	#		add_permanent_province_modifier = { 
	#			name = woad_type
	#			duration = -1  
	#			desc = woad_type_tooltip
	#		}
	#	}
	#}
	#if = {
	#	limit = { 
	#		ROOT = { 
	#			AND = {
	#				NOT = { trade_goods = indigo }
	#				OR = {
	#					has_province_modifier = woad_type
	#					has_province_modifier = woad_type_bad
	#				}
	#			}
	#		}
	#	}
	#	remove_province_modifier = woad_type
	#	remove_province_modifier = woad_type_bad
	#}

	if = {
		limit = {
			ROOT = {
				has_province_flag = has_cannon
			}
		}
		ROOT = {
			goods_save = yes
			change_trade_goods = cannon
		}
	}
	
	if = {
		limit = {
			ROOT = {
				has_province_flag = has_metalworking
			}
		}
		ROOT = {
			goods_save = yes
			change_trade_goods = metalworking
		}
	}
	
	if = {
		limit = {
			ROOT = {
				has_province_flag = has_steam_engine
			}
		}
		ROOT = {
			goods_save = yes
			change_trade_goods = steam_engine
		}
	}
	
	if = {
		limit = {
			ROOT = {
				has_province_flag = has_optics
			}
		}
		ROOT = {
			goods_save = yes
			change_trade_goods = optics
		}
	}
	
	if = {
		limit = {
			ROOT = {
				has_province_flag = has_munitions
			}
		}
		ROOT = {
			goods_save = yes
			change_trade_goods = munitions
		}
	}
}

